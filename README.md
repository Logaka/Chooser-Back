# Chooser Backend


⚠️ **Внимание:** Бэкенд развернут на платформе [Render](https://render.com).  
При первом обращении после простоя он может **долго загружаться (40–100 секунд)** —  
это связано с особенностями бесплатного тарифа (сервер "засыпает" при неактивности).  
Пожалуйста, подождите немного при первом запуске.

## Краткое описание проекта

Chooser Backend — это REST API сервис, разработанный для рандомного выбора игрока из группы и назначения заданий различной сложности. Приложение имеет два основных режима:

1. **RANDOM** — выбирает случайного игрока из предоставленного списка.
2. **TASK** — выбирает случайного игрока и назначает ему задание определенного уровня сложности (EASY, MEDIUM, HARD).

Сервис разработан с использованием Spring Boot и представляет собой надежную, масштабируемую платформу для игровых приложений или других ситуаций, где требуется случайный выбор участников.

## Технический стек

Проект использует следующие технологии:

- **Java 21** — последняя LTS версия с улучшенной производительностью и современными языковыми возможностями
- **Spring Boot 3.4.5** — фреймворк для создания микросервисов и веб-приложений
- **Spring Data JPA** — для взаимодействия с базой данных
- **PostgreSQL** — надежная реляционная СУБД для хранения данных
- **Maven** — система сборки и управления зависимостями
- **Docker** — для контейнеризации и удобного развертывания
- **Lombok** — для уменьшения шаблонного кода

### Почему этот стек?

- **Java 21**: Выбрана последняя LTS версия для максимальной производительности и поддержки современных функций языка
- **Spring Boot**: Обеспечивает быструю разработку, имеет встроенную поддержку валидации, обеспечивает легкую настройку безопасности
- **PostgreSQL**: Надежная, производительная база данных с поддержкой сложных запросов и транзакций
- **Docker**: Обеспечивает изоляцию, портативность и легкость развертывания
- **Lombok и MapStruct**: Позволяют сократить шаблонный код и повысить читаемость

## Инструкции по установке и запуску

### Предварительные требования

- Java 21 или выше
- Maven 3.6+
- Docker и Docker Compose (для запуска в контейнерах)
- PostgreSQL (если запускаете без Docker)

### Запуск приложения через Docker

1. Клонировать репозиторий:
   ```
   git clone <url-репозитория>
   cd Chooser-Back
   ```

2. Создать файл `.env` с необходимыми переменными окружения:
   ```
   POSTGRES_USER=postgres
   POSTGRES_PASSWORD=postgres
   POSTGRES_DB=chooser
   POSTGRES_URL=url
   ```

3. Запустить с помощью Docker Compose:
   ```
   docker-compose up -d
   ```

4. Приложение будет доступно по адресу: `http://localhost:8080`

### Запуск приложения локально

1. Клонировать репозиторий
2. Настроить PostgreSQL и обновить `application.properties` с данными подключения
3. Запустить приложение:
   ```
   ./mvnw spring-boot:run
   ```

## API Endpoints

### Начать игру
```
POST /api/v1/start
```

#### Пример запроса (режим TASK):
```json
{
    "playerIds": [1, 2, 3, 4],
    "gameOption": {
        "mode": "TASK",
        "taskLevel": "EASY"
    }
}
```

#### Пример ответа:
```json
{
    "sessionId": "some-session-id",
    "choosenPlayerId": 2,
    "task": {
        "text": "Подпрыгни 5 раз!",
        "level": "EASY"
    }
}
```

#### Пример запроса (режим RANDOM):
```json
{
    "playerIds": [1, 2, 3, 4],
    "gameOption": {
        "mode": "RANDOM"
    }
}
```

#### Пример ответа:
```json
{
    "sessionId": null,
    "choosenPlayerId": 3,
    "task": null
}
```

## Процесс проектирования и разработки

Проект разрабатывался с использованием итеративного подхода:

1. **Планирование и проектирование**:
   - Определение основных требований
   - Создание модели данных
   - Планирование API

2. **Разработка**:
   - Создание скелета приложения с использованием Spring Boot
   - Разработка основной логики выбора игрока и заданий
   - Реализация REST API
   - Добавление валидации

3. **Тестирование**:
   - Функциональное тестирование API
   - Тестирование производительности
   - Нагрузочное тестирование

4. **Оптимизация**:
   - Улучшение производительности получения случайных заданий
   - Добавление кеширования для частых операций
   - Настройка конфигурации Docker

## Уникальные подходы

1. **Оптимизированный алгоритм выбора случайного задания**:
   Вместо неэффективного `ORDER BY RANDOM()` в SQL, приложение получает список ID всех подходящих заданий и выбирает случайный ID в памяти, что существенно повышает производительность.

2. **Эффективное кеширование заданий**:
   Список ID заданий кешируется при запуске приложения, что уменьшает количество обращений к базе данных.

3. **Кастомная валидация для условной проверки полей**:
   Реализована валидация, которая требует указания уровня задания (taskLevel) только когда режим игры установлен как TASK.

## Компромиссы при разработке

1. **Хранение сессий в памяти vs. в базе данных**:
   Сессии хранятся в памяти для повышения производительности, но при перезапуске приложения данные сессии теряются.

2. **Кеширование vs. актуальность данных**:
   Для повышения производительности используется кеширование ID заданий, но это может привести к тому, что новые задания, добавленные в базу данных, не будут сразу доступны без перезапуска приложения.

3. **Упрощенная модель данных**:
   Для текущей версии выбрана упрощенная модель данных, что ускоряет разработку, но может ограничить функциональность в будущем.

## Известные ошибки и проблемы

1. **Отсутствие режима выбывания**: Отстутствует режим выбывания.


## Дальнейшее развитие

1. Добавление аутентификации и авторизации
2. Реализация хранения сессий в Redis для поддержки масштабирования
3. Расширение API для поддержки более сложных сценариев
4. Добавление метрик и мониторинга
5. Внедрение более богатой модели данных для игр и заданий 
